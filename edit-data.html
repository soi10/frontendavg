<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Responsive Admin &amp; Dashboard Template based on Bootstrap 5">
    <meta name="author" content="AdminKit">
    <meta name="keywords"
        content="adminkit, bootstrap, bootstrap 5, admin, dashboard, template, responsive, css, sass, html, theme, front-end, ui kit, web">

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="shortcut icon" href="./static/img/icons/icon-48x48.png" />

    <link rel="canonical" href="https://demo-basic.adminkit.io/" />
    <script src="./static/js/sweetalert2v10.js"></script>
    <title>โปรแกรมเฉลี่ยหน่วยมิเตอร์ TOU</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>

    <link href="./static/css/app.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Kanit' rel='stylesheet'>

    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/i18n/datepicker-th.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <style>
        body {
            font-family: 'Kanit';
            font-size: 14px;
        }
    </style>
</head>

<body>
    <div class="wrapper">
        <nav id="sidebar" class="sidebar js-sidebar">
            <div class="sidebar-content js-simplebar">
                <a class="sidebar-brand" href="index.html">
                    <img src="./src/img/logo.jpg" alt="Charles Hall" class="img-fluid rounded-circle" width="18%"
                        height="18%" /><span class="align-middle"> EVEREST</span>
                </a>

                <ul class="sidebar-nav">
                    <li class="sidebar-header">
                        Pages
                    </li>

                    <li class="sidebar-item">
                        <a class="sidebar-link" href="index.html">
                            <i class="align-middle" data-feather="bar-chart-2"></i> <span
                                class="align-middle">Dashboard</span>
                        </a>
                    </li>
                    <li class="sidebar-item">
                        <a class="sidebar-link" href="home.html">
                            <i class="align-middle" data-feather="list"></i> <span
                                class="align-middle">ข้อมูลการเฉลี่ยหน่วย</span>
                        </a>
                    </li>
                    <li class="sidebar-item active">
                        <a class="sidebar-link" href="everest.html">
                            <i class="align-middle" data-feather="sliders"></i> <span
                                class="align-middle">ดำเนินการเฉลี่ยหน่วย</span>
                        </a>
                    </li>

                    <li class="sidebar-item">
                        <a class="sidebar-link" href="holiday.html">
                            <i class="align-middle" data-feather="plus-square"></i> <span
                                class="align-middle">เพิ่มวันหยุด</span>
                        </a>
                    </li>
                </ul>


        </nav>

        <div class="main">
            <nav class="navbar navbar-expand navbar-light navbar-bg">
                <a class="sidebar-toggle js-sidebar-toggle">
                    <i class="hamburger align-self-center"></i>
                </a>

                <div class="navbar-collapse collapse">
                    <ul class="navbar-nav navbar-align">
                        <li class="nav-item dropdown">
                            <a class="nav-icon dropdown-toggle d-inline-block d-sm-none" href="#"
                                data-bs-toggle="dropdown">
                                <i class="align-middle" data-feather="settings"></i>
                            </a>

                            <a class="nav-link dropdown-toggle d-none d-sm-inline-block" href="#"
                                data-bs-toggle="dropdown">
                                <span class="text-dark"><span id="Name"></span> <span id="DepartmentShortName"></span>
                                    <span id="BaName"></span>
                            </a>
                            <div class="dropdown-menu dropdown-menu-end">
                                <span id="outer">
                                    <a class="dropdown-item" href="#" id="btnLogout">Log out</a>
                                </span>
                            </div>
                        </li>
                    </ul>
                </div>
            </nav>

            <main class="content">
                <div class="container-fluid p-0">

                    <div id="page1" class="my-2">
                        <div class="container-fluid p-0">

                            <h1 class="h3 mb-3">กรอกข้อมูลผู้ใช้ไฟฟ้า</h1>
                            <div class="row">
                                <div class="col-12 col-lg-12 col-xxl-12 d-flex">
                                    <div class="card flex-fill">
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-3">
                                                    <div class="mb-3">
                                                        <label for="formFile" class="form-label">ระบุการไฟฟ้า</label>
                                                        <select class="form-select mb-3" id="office">
                                                            <option value="">--เลือกข้อมูล--</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-3">
                                                    <div class="mb-3">
                                                        <label for="formFile"
                                                            class="form-label">หมายเลขผู้ใช้ไฟฟ้า</label>
                                                        <input type="text" class="form-control" id="ca"
                                                            placeholder="0200xxxxx">
                                                    </div>
                                                </div>
                                                <div class="col-4">
                                                    <div class="mb-3">
                                                        <label for="formFile" class="form-label">อัตรา</label>
                                                        <select class="form-select" id="rate">

                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-3">
                                                    <div class="mb-3">
                                                        <label for="formFile"
                                                            class="form-label">ประเภทผู้ใช้ไฟฟ้า</label>
                                                        <select class="form-select mb-3" id="type-customer">
                                                            <option value="">--เลือกประเภทผู้ใช้ไฟฟ้า--</option>
                                                            <option value="รายใหญ่">-รายใหญ่</option>
                                                            <option value="รายย่อย">-รายย่อย</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <!-- <div class="col-2">
													<div class="mb-3">
														<label for="formFile" class="form-label">ตัวคูณ</label>
														<input type="text" class="form-control" id="multiplier"
															placeholder="">
													</div>
												</div> -->
                                            </div>
                                            <div class="row">
                                                <div class="col-3">
                                                    <div class="mb-3">
                                                        <label for="formFile" class="form-label">ชื่อ</label>
                                                        <input type="text" class="form-control" id="customer-name"
                                                            placeholder="ชื่อ">
                                                    </div>
                                                </div>
                                                <div class="col-7">
                                                    <div class="mb-3">
                                                        <label for="formFile" class="form-label">สถานที่ใช้ไฟฟ้า</label>
                                                        <input type="text" class="form-control" id="address"
                                                            placeholder="สถานที่ใช้ไฟฟ้า">
                                                    </div>
                                                </div>

                                            </div>
                                            <div class="row">
                                                <div class="col-3">
                                                    <div class="mb-3">
                                                        <label for="formFile" class="form-label">PEA No.</label>
                                                        <input type="text" class="form-control" id="peano"
                                                            placeholder="pea no">
                                                    </div>
                                                </div>
                                                <div class="col-3">
                                                    <div class="mb-3">
                                                        <label for="formFile"
                                                            class="form-label">รอบบิลที่ต้องการทำการเฉลี่ย</label>
                                                        <select class="form-select mb-3" id="month">
                                                            <option value="">--เลือกข้อมูล--</option>
                                                            <option value="มกราคม">มกราคม</option>
                                                            <option value="กุมภาพันธ์">กุมภาพันธ์</option>
                                                            <option value="มีนาคม">มีนาคม</option>
                                                            <option value="เมษายน">เมษายน</option>
                                                            <option value="พฤษภาคม">พฤษภาคม</option>
                                                            <option value="มิถุนายน">มิถุนายน</option>
                                                            <option value="กรกฎาคม">กรกฎาคม</option>
                                                            <option value="สิงหาคม">สิงหาคม</option>
                                                            <option value="กันยายน">กันยายน</option>
                                                            <option value="ตุลาคม">ตุลาคม</option>
                                                            <option value="พฤศจิกายน">พฤศจิกายน</option>
                                                            <option value="ธันวาคม">ธันวาคม</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-2">
                                                    <div class="mb-3">
                                                        <label for="formFile" class="form-label">ปี</label>
                                                        <select class="form-select mb-3" id="year">

                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-3">
                                                        <div class="mb-3">
                                                            <label for="formFile"
                                                                class="form-label">สาเหตุที่ชำรุด</label>
                                                            <input type="text" class="form-control" id="cause"
                                                                placeholder="">
                                                        </div>
                                                    </div>
                                                    <!-- <div class="col-2">
														<div class="mb-3">
															<label for="formFile" class="form-label">ตัวคูณ</label>
															<input type="text" class="form-control" id="multiplier"
																placeholder="">
														</div>
													</div> -->
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="row">
                            <div class="col">
                                <!-- <button type="button" class="btn btn-secondary" id="back1">กลับ</button> -->
                            </div>
                            <div class="col">
                                <button type="button" class="btn btn-facebook float-end" id="nextpage2">
                                    <i class="align-middle me-2" data-feather="arrow-right-circle"></i> <span
                                        class="align-middle">ยืนยัน/ดำเนินการต่อไป</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <!-- End page1 -->

                    <div id="page2" class="my-2">
                        <div class="container-fluid p-0">
                            <h1 class="h3 mb-3">แก้ไขข้อมูล</h1>
                            <div class="row">
                                <div class="col d-flex justify-content-center">
                                    <div class="card flex-fill">
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-5">
                                                    <div class="mb-3">
                                                        <label for="formFile" class="form-label">กรณีชำรุด</label>
                                                        <select class="form-select mb-3" disabled id="case-ex">
                                                            <!-- <option selected value="">--เลือกข้อมูล--</option>
                                                            <option
                                                                value="เฉลี่ยจากใบอ่านหน่วย(ใช้ข้อมูลเลขอ่านครั้งก่อน-เลขอ่านครั้งหลัง)">
                                                                เฉลี่ยจากใบอ่านหน่วย
                                                                (ใช้ข้อมูลเลขอ่านครั้งก่อน-เลขอ่านครั้งหลัง)
                                                            </option>
                                                            <option value="เฉลี่ยจากข้อมูลสถิติการใช้ไฟฟ้า">
                                                                เฉลี่ยจากข้อมูลสถิติการใช้ไฟฟ้า
                                                            </option>
                                                            <option value="เฉลี่ยจากเปอร์เซ็นความคลาดเคลื่อนของมิเตอร์">
                                                                เฉลี่ยจากเปอร์เซ็นความคลาดเคลื่อนของมิเตอร์
                                                            </option> -->
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div id="step1" style="display:none;">
                            <div class="container-fluid p-0">
                                <h1 class="h3 mb-3">ข้อมูลช่วงที่ชำรุด</h1>
                                <div class="row">
                                    <div class="col d-flex justify-content-center">
                                        <div class="card flex-fill">
                                            <div class="card-body">
                                                <div class="container text-center">
                                                    <div class="row">
                                                        <div class="col">
                                                            <h5 class="card-title mb-0">ช่วงฐาน(ช่วงปกติ)</h5>
                                                        </div>
                                                        <div class="col">
                                                            &nbsp;
                                                        </div>
                                                        <div class="col">
                                                            <h5 class="card-title mb-0">ช่วงชำรุด</h5>

                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="container text-center">
                                                    <div class="row">
                                                        <div class="col">
                                                            <div class="mb-3">
                                                                <label for="start-date">วันที่เริ่มต้น:</label>
                                                                <input class="form-control" type="text"
                                                                    id="start-date-normal" name="start-date-normal" />
                                                            </div>
                                                        </div>
                                                        <div class="col-1">
                                                            ถึง
                                                        </div>
                                                        <div class="col">
                                                            <div class="mb-3">
                                                                <label for="end-date">วันที่สิ้นสุด:</label>
                                                                <input class="form-control" type="text"
                                                                    id="end-date-normal" name="end-date-normal" />
                                                            </div>
                                                        </div>
                                                        <div class="col">
                                                            &nbsp;
                                                        </div>
                                                        <div class="col">
                                                            <div class="mb-3">
                                                                <label for="start-date">วันที่เริ่มต้น:</label>
                                                                <input class="form-control" type="text"
                                                                    id="start-date-not" name="start-date-not" />
                                                            </div>
                                                        </div>
                                                        <div class="col-1">
                                                            ถึง
                                                        </div>
                                                        <div class="col">
                                                            <div class="mb-3">
                                                                <label for="end-date">วันที่สิ้นสุด:</label>
                                                                <input class="form-control" type="text"
                                                                    id="end-date-not" name="end-date-not" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="container text-center">
                                                    <div class="row">
                                                        <div class="col">
                                                            <button type="button" class="btn btn-facebook my-2"
                                                                id="submit-btn" name="#submit-btn">
                                                                <i class="align-middle me-2"
                                                                    data-feather="check-circle"></i> <span
                                                                    class="align-middle">ดำเนินการ</span>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="container">
                                                    <div class="row">
                                                        <div class="col">
                                                            &nbsp;
                                                        </div>
                                                        <div class="col">
                                                            วันช่วงฐาน
                                                            <div id="resultP"></div>
                                                            <div id="resultOP"></div>
                                                            <div id="resultH"></div>
                                                            <div id="resultSum"></div>
                                                        </div>
                                                        <div class="col">

                                                        </div>
                                                        <div class="col">
                                                            <div>&nbsp;</div>
                                                            <div>&nbsp;</div>
                                                            <div>&nbsp;</div>
                                                            <h3>
                                                                <div id="resultSumAc"></div>
                                                            </h3>
                                                        </div>
                                                        <div class="col">
                                                            &nbsp;
                                                        </div>
                                                        <div class="col">
                                                            วันช่วงชำรุด
                                                            <div id="result-workDay-notP"></div>
                                                            <div id="result-offkDay-notOP"></div>
                                                            <div id="result-offkDay-notH"></div>
                                                            <div id="result-countDay-notSum"></div>
                                                        </div>
                                                        <div class="col">
                                                            &nbsp;
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="container text-center">
                                                    <div class="row">
                                                        <div class="col">
                                                            <div id="btn-save-con"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <!-- <button type="button" class="btn btn-secondary" id="backpage1">
                                    <i class="align-middle me-2" data-feather="arrow-left-circle"></i> <span
                                        class="align-middle">กลับ</span>
                                </button> -->
                            </div>
                            <div class="col">
                                <button type="button" class="btn btn-facebook float-end" id="nextpage3">
                                    <i class="align-middle me-2" data-feather="arrow-right-circle"></i> <span
                                        class="align-middle">ยืนยัน/ดำเนินการต่อไป</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <!--end div id="page2"-->
                    <div id="page3" class="my-2">
                        <div class="container-fluid p-0">

                            <h1 class="h3 mb-3">รายละเอียดการแก้ไขเฉลี่ยหน่วยการใช้ไฟฟ้า</h1>
                            <div class="row">
                                <div class="col d-flex justify-content-center">
                                    <div class="card flex-fill">
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="container text-center">
                                                    <div class="row">
                                                        <div class="col-sm-12">
                                                            <h4>CA: <span id="ca-sum"></span> ชื่อผู้ใช้ไฟฟ้า <span
                                                                    id="customer-sum"></span></h4>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-12">
                                                            <h5>สาเหตุที่ดำเนินการเฉลี่ยหน่วยในรอบบิล เดือน <span
                                                                    id="month-sum"></span> ปี <span
                                                                    id="year-sum"></span>
                                                                เนื่องจาก <span id="case-sum"></span></h5>
                                                            <h5>เฉลี่ยกรณี - <span id="caseex-sum"></span></h5>
                                                            <h5>ข้อมูลช่วงฐานจากวันที่ <span
                                                                    id="start_date_normal1"></span> ถึง <span
                                                                    id="end-date-normal1"></span>
                                                                ข้อมูลช่วงชำรุดวันที่ &nbsp;&nbsp;<span
                                                                    id="start-date-not1"></span>
                                                                ถึง <span id="end-date-not1"></span>
                                                            </h5>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        &nbsp;
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-12">
                                                            <b>หน่วยการใช้ไฟ</b>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-1">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            เลขอ่านครั้งหลัง
                                                        </div>
                                                        <div class="col-sm-1">
                                                            เลขอ่านครั้งก่อน
                                                        </div>
                                                        <div class="col-sm-1">
                                                            ตัวคูณ
                                                        </div>
                                                        <div class="col-sm-1">
                                                            หน่วยช่วงที่ปกติ
                                                        </div>
                                                        <div class="col-sm-1">
                                                            วันที่ปกติ
                                                        </div>
                                                        <div class="col-sm-1">
                                                            เฉลี่ยต่อวัน
                                                        </div>
                                                        <div class="col-sm-1">
                                                            วันที่ชำรุด
                                                        </div>
                                                        <div class="col-sm-3">
                                                            หน่วยเฉลี่ยช่วงที่ชำรุด*นำไปลงในระบบ SAP
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-1">
                                                            kWh-P
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control" id="KWPPAfter"
                                                                style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control" id="KWPPBefore"
                                                                style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control" id="KWPPmultiplier"
                                                                onkeyup="CalKWPP()" style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control" id="KWPPUnitNormol"
                                                                disabled style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control" id="KWPPresultP-Sum"
                                                                disabled style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control" id="KWPPAvg"
                                                                disabled style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control"
                                                                id="KWPPresult-workDay-notP-Sum" disabled
                                                                style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <input type="text" class="form-control"
                                                                id="KWPPavg-unit-tosap" disabled
                                                                style="text-align: right">
                                                        </div>
                                                    </div>
                                                    <br>
                                                    <div class="row">
                                                        <div class="col-sm-1">
                                                            kWh-OP
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control" id="KWPOPAfter"
                                                                style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control" id="KWPOPBefore"
                                                                style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control" id="KWPOPmultiplier"
                                                                onkeyup="CalKWPOP()" style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control" id="KWPOPUnitNormol"
                                                                disabled style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control"
                                                                id="KWPOPresultP-Sum" disabled
                                                                style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control" id="KWPOPAvg"
                                                                disabled style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control"
                                                                id="KWPOPresult-workDay-notP-Sum" disabled
                                                                style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <input type="text" class="form-control"
                                                                id="KWPOPavg-unit-tosap" disabled
                                                                style="text-align: right">
                                                        </div>
                                                    </div>
                                                    <br>
                                                    <div class="row">
                                                        <div class="col-sm-1">
                                                            kWh-H
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control" id="KWPHAfter"
                                                                style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control" id="KWPHBefore"
                                                                style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control" id="KWPHmultiplier"
                                                                onkeyup="CalKWPH()" style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control" id="KWPHUnitNormol"
                                                                disabled style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control" id="KWPHresultP-Sum"
                                                                disabled style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control" id="KWPHAvg"
                                                                disabled style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control"
                                                                id="KWPHresult-workDay-notP-Sum" disabled
                                                                style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <input type="text" class="form-control"
                                                                id="KWPHavg-unit-tosap" disabled
                                                                style="text-align: right">
                                                        </div>
                                                    </div>
                                                    <br>
                                                    <div class="row">
                                                        <div class="col-sm-1">

                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="hidden" class="form-control" id="" disabled
                                                                style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="hidden" class="form-control" id="" disabled
                                                                style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <b>รวมหน่วยฐาน</b>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control"
                                                                id="sum-normal-final" disabled
                                                                style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="hidden" class="form-control" id="" disabled
                                                                style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="hidden" class="form-control" id="" disabled
                                                                style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <b>รวมหน่วยเฉลี่ย</b>
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <input type="text" class="form-control"
                                                                id="sum-to-sap-final" disabled
                                                                style="text-align: right">
                                                        </div>
                                                    </div>
                                                    <br>
                                                    <div class="row ">
                                                        <div class="d-flex">
                                                            <div>
                                                                <h6><span class="badge"
                                                                        style="background-color: #C7911B; color: white;">*หมายเหตุ*
                                                                        เฉลี่ยหน่วยโดยไม่บวกหน่วยสูญเสีย 2% เพราะลงใน
                                                                        EL29 ให้ระบบ SAP คำนวนเอง</span></h6>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <br>
                                                    <div class="row">
                                                        <div class="col-sm-12">
                                                            <b>กิโลวัตต์ หน่วยการใช้ไฟ</b>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-1">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            เลขอ่านครั้งหลัง
                                                        </div>
                                                        <div class="col-sm-1">
                                                            เลขอ่านครั้งก่อน
                                                        </div>
                                                        <div class="col-sm-1">
                                                            ตัวคูณ
                                                        </div>
                                                        <div class="col-sm-1">
                                                            กิโลวัตต์ช่วงปกติ
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-1">
                                                            KWP-P
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control" id="KKWPPAfter"
                                                                style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control" id="KKWPPBefore"
                                                                style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control" id="KKWPPmultiplier"
                                                                onkeyup="CalKKWPP()" style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control" id="KKWPPUnitNormol"
                                                                disabled style="text-align: right">
                                                        </div>
                                                    </div>
                                                    <br>
                                                    <div class="row">
                                                        <div class="col-sm-1">
                                                            KWP-OP
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control" id="KKWPOPAfter"
                                                                style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control" id="KKWPOPBefore"
                                                                style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control"
                                                                id="KKWPOPmultiplier" onkeyup="CalKKWPOP()"
                                                                style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control"
                                                                id="KKWPOPUnitNormol" disabled
                                                                style="text-align: right">
                                                        </div>
                                                    </div>
                                                    <br>
                                                    <div class="row">
                                                        <div class="col-sm-1">
                                                            KWP-H
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control" id="KKWPHAfter"
                                                                style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control" id="KKWPHBefore"
                                                                style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control" id="KKWPHmultiplier"
                                                                onkeyup="CalKKWPH()" style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <input type="text" class="form-control" id="KKWPHUnitNormol"
                                                                disabled style="text-align: right">
                                                        </div>
                                                        <div class="col-sm-1">
                                                            หมายเหตุ
                                                        </div>
                                                        <div class="col-sm-5">
                                                            <textarea class="form-control" id="comment"
                                                                rows="2"></textarea>
                                                            <!-- <input type="text" class="form-control" id="comment"> -->
                                                        </div>
                                                    </div>
                                                    <br>
                                                    <div class="row ">
                                                        <div class="d-flex">
                                                            <div>
                                                                <h6><span class="badge"
                                                                        style="background-color: #C7911B; color: white;">*หมายเหตุ*
                                                                        กรณีเฉลี่ยจากสถิติในเดือนไม่ต้องดำเนินการเฉลี่ยกิโลวัตต์
                                                                        หรือสามารถนำกิโลวัตต์ช่วงปกติมาเฉลี่ยได้</span>
                                                                </h6>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="row">
                            <div class="col">
                                <button type="button" class="btn btn-secondary" id="backpage2">
                                    <i class="align-middle me-2" data-feather="arrow-left-circle"></i> <span
                                        class="align-middle">กลับ</span>
                                </button>
                            </div>
                            <div class="col">
                                <button type="button" class="btn btn-facebook float-end" id="save">
                                    <i class="align-middle me-2" data-feather="arrow-right-circle"></i> <span
                                        class="align-middle">ยืนยัน/บันทึกข้อมูล</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <!-- End page3 -->
                </div>
                <input type="hidden" id="KWPPresultP-Sum">
                <!-- //<input type="hidden" id="KWPPresult-workDay-notP-Sum"> -->
                <input type="hidden" id="p_normal">
                <input type="hidden" id="op_normal">
                <input type="hidden" id="h_normal">
                <input type="hidden" id="sum_normal">
                <input type="hidden" id="p_brok">
                <input type="hidden" id="op_brok">
                <input type="hidden" id="h_brok">
                <input type="hidden" id="sum_brok">
                <input type="hidden" id="sum_all">
                <input type="hidden" id="resultSumAcCheckIf">
                <!-- <input type="text" id="in-cause"> -->
                <!-- <span id="in-cause1">d</span> -->
            </main>

        </div>
    </div>

    <script src="./static/js/app.js"></script>

</body>

</html>
<script>
    $(document).ready(function () {
        var hostname = '172.21.1.60';
        var getUrlParameter = function getUrlParameter(sParam) {
            var sPageURL = window.location.search.substring(1),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');

                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
                }
            }
            return false;
        };
        let iddata = getUrlParameter('id');
        console.log(iddata)
        $.ajax({
            url: "http://localhost:442/datadetail/id",
            contentType: "application/json",
            data: {
                id: iddata
            },
            success: function (data) {
                //console.log(data[0].unit_use.kwh_op)
                console.log(data[0].kwh_unit.kwh_op)
                $("#case-ex").html('<option selected disabled value="' + data[0].in_cause + '">' + data[0].in_cause)
                if (data[0].in_cause == 'เฉลี่ยจากใบอ่านหน่วย(ใช้ข้อมูลเลขอ่านครั้งก่อน-เลขอ่านครั้งหลัง)') {
                    $("#step1").show();
                }
                $("#ca-sum").html(data[0].ca_no);
                $("#customer-sum").html(data[0].name_customer);
                $("#month-sum").html(data[0].billing_Cycle);
                $("#year-sum").html(data[0].year);
                $("#case-sum").html(data[0].cause);
                $("#start-date-normal").val(convertDateFormat(data[0].data_broken.normal_date_start));
                $("#end-date-normal").val(convertDateFormat(data[0].data_broken.normal_date_end));
                $("#start-date-not").val(convertDateFormat(data[0].data_broken.brok_date_start));
                $("#end-date-not").val(convertDateFormat(data[0].data_broken.brok_date_end));
                $("#caseex-sum").html(data[0].in_cause);
                $("#KWPPAfter").val(data[0].unit_use.kwh_p.unit_read_after_kwh_p);
                $("#KWPPBefore").val(data[0].unit_use.kwh_p.unit_read_before_kwh_p);
                $("#KWPPmultiplier").val(data[0].unit_use.kwh_p.multiplier_kwh_p);
                $("#KWPPUnitNormol").val(data[0].unit_use.kwh_p.unit_normal_kwh_p);
                $("#KWPPresultP-Sum").val(data[0].unit_use.kwh_p.date_normal_kwh_p);
                $("#KWPPAvg").val(data[0].unit_use.kwh_p.avg_date_kwh_p);
                $("#KWPPresult-workDay-notP-Sum").val(data[0].unit_use.kwh_p.date_brok_kwh_p);
                $("#KWPPavg-unit-tosap").val(data[0].unit_use.kwh_p.unit_avg_to_sap_kwh_p);
                $("#KWPOPAfter").val(data[0].unit_use.kwh_op.unit_read_after_kwh_op);
                $("#KWPOPBefore").val(data[0].unit_use.kwh_op.unit_read_before_kwh_op);
                $("#KWPOPmultiplier").val(data[0].unit_use.kwh_op.multiplier_kwh_op);
                $("#KWPOPUnitNormol").val(data[0].unit_use.kwh_op.unit_normal_kwh_op);
                $("#KWPOPresultP-Sum").val(data[0].unit_use.kwh_op.date_normal_kwh_op);
                $("#KWPOPAvg").val(data[0].unit_use.kwh_op.avg_date_kwh_op);
                $("#KWPOPresult-workDay-notP-Sum").val(data[0].unit_use.kwh_op.date_brok_kwh_op);
                $("#KWPOPavg-unit-tosap").val(data[0].unit_use.kwh_op.unit_avg_to_sap_kwh_op);
                $("#KWPHAfter").val(data[0].unit_use.kwh_h.unit_read_after_kwh_h);
                $("#KWPHBefore").val(data[0].unit_use.kwh_h.unit_read_before_kwh_h);
                $("#KWPHmultiplier").val(data[0].unit_use.kwh_h.multiplier_kwh_h);
                $("#KWPHUnitNormol").val(data[0].unit_use.kwh_h.unit_normal_kwh_h);
                $("#KWPHresultP-Sum").val(data[0].unit_use.kwh_h.date_normal_kwh_h);
                $("#KWPHAvg").val(data[0].unit_use.kwh_h.avg_date_kwh_h);
                $("#KWPHresult-workDay-notP-Sum").val(data[0].unit_use.kwh_h.date_brok_kwh_h);
                $("#KWPHavg-unit-tosap").val(data[0].unit_use.kwh_h.unit_avg_to_sap_kwh_h);
                $("#KKWPPAfter").val(data[0].kwh_unit.kwh_p.unit_read_after_unit_kwh_p);
                $("#KKWPPBefore").val(data[0].kwh_unit.kwh_p.unit_read_before_unit_kwh_p);
                $("#KKWPPmultiplier").val(data[0].kwh_unit.kwh_p.multiplier_unit_kwh_p);
                $("#KKWPPUnitNormol").val(data[0].kwh_unit.kwh_p.kwh_normal_unit_kwh_p);
                $("#KKWPOPAfter").val(data[0].kwh_unit.kwh_op.unit_read_after_unit_kwh_op);
                $("#KKWPOPBefore").val(data[0].kwh_unit.kwh_op.unit_read_before_unit_kwh_op);
                $("#KKWPOPmultiplier").val(data[0].kwh_unit.kwh_op.multiplier_unit_kwh_op);
                $("#KKWPOPUnitNormol").val(data[0].kwh_unit.kwh_op.kwh_normal_unit_kwh_op);
                $("#KKWPHAfter").val(data[0].kwh_unit.kwh_h.unit_read_after_unit_kwh_h);
                $("#KKWPHBefore").val(data[0].kwh_unit.kwh_h.unit_read_before_unit_kwh_h);
                $("#KKWPHmultiplier").val(data[0].kwh_unit.kwh_h.multiplier_unit_kwh_h);
                $("#KKWPHUnitNormol").val(data[0].kwh_unit.kwh_h.kwh_normal_unit_kwh_h);
                $("#user").html(data[0].user);
                $("#sum-normal-final").val(data[0].sum_normal_final);
                $("#sum-to-sap-final").val(data[0].sum_to_sap_final);
                $("#comment").html(data[0].comment);
            },
            error: function (data) {

            }
        })
    })
</script>
<script>
    var hostname = "localhost";
    $(document).ready(function () {
        $("#Name").html(localStorage.getItem("FullName"));
        $("#BaName").html(localStorage.getItem("BaName"));
        $("#DepartmentShortName").html(localStorage.getItem("DepartmentShortName"));
        // console.log(localStorage.getItem("Peacode").substring(0, 4))

        $("#page1").hide();
        $("#page2").show();
        $("#page3").hide();

        // ใช้ datepicker กับ input ของวันที่เริ่มต้น
        $("#start-date-normal").datepicker({
            dateFormat: 'dd-mm-yy',
            language: 'th',
            thaiyear: true
        });

        // ใช้ datepicker กับ input ของวันที่สิ้นสุด
        $("#end-date-normal").datepicker({
            dateFormat: 'dd-mm-yy',
            language: 'th',
            thaiyear: true
        });

        $("#start-date-not").datepicker({
            dateFormat: 'dd-mm-yy',
            language: 'th',
            thaiyear: true
        });

        // ใช้ datepicker กับ input ของวันที่สิ้นสุด
        $("#end-date-not").datepicker({
            dateFormat: 'dd-mm-yy',
            language: 'th',
            thaiyear: true
        });
    });

    // $("#nextpage2").click(function () {
    //     if (document.getElementById("office").value.length == 0 || document.getElementById("ca").value.length == 0 || document.getElementById("customer-name").value.length == 0 || document.getElementById("rate").value.length == 0 || document.getElementById("peano").value.length == 0 || document.getElementById("month").value.length == 0 || document.getElementById("year").value.length == 0 || document.getElementById("cause").value.length == 0) {
    //         Swal.fire({
    //             icon: 'error',
    //             title: 'Oops...',
    //             text: 'กรุณากรอกข้อมูลให้ครบทุกช่อง!',
    //         })
    //     } else {
    //         $("#page1").hide();
    //         $("#page2").show();
    //         $("#page3").hide();
    //     }

    // });
    $("#nextpage3").click(function () {
        // if (document.getElementById("case-ex").value.length == 0) {
        //     Swal.fire({
        //         icon: 'error',
        //         title: 'Oops...',
        //         text: 'กรุณากรอกข้อมูลให้ครบทุกช่อง!',
        //     })
        // } else {
        $("#page1").hide();
        $("#page2").hide();
        $("#page3").show();
        // }
    });

    $("#backpage1").click(function () {
        $("#page1").show();
        $("#page2").hide();
        $("#page3").hide();
    });
    $("#backpage2").click(function () {
        $("#page1").hide();
        $("#page2").show();
        $("#page3").hide();
    });



    // 
    // กำหนด options และเรียกใช้งาน Select2 ด้วย Ajax
    $.ajax({
        url: "http://" + hostname + ":442/uploadrate",
        dataType: "json",
        success: function (data) {
            // สร้าง options ของ select2
            var options = '<option value="">--เลือกข้อมูล--</option>'; // option เริ่มต้น
            for (var i = 0; i < data.length; i++) {
                options += '<option value="' + data[i].group_no + data[i].detail + '">' + data[i].group_no + ' ' + data[i].detail + '</option>';
            }
            // กำหนด options ของ select2
            $('#rate').html(options);
            // เปิดใช้งาน select2
            $('#rate').select2();
        }
    });
    // กำหนดค่า default ให้กับ select list เดือน
    var currentMonth = new Date().getMonth() + 1;
    // $("#month").val(currentMonth);

    // เปิดใช้งาน select2
    $('#month').select2();

    // สร้าง array ของปี
    var years = [];
    var currentYear = new Date().getFullYear();
    for (var i = 2; i >= 0; i--) {
        years.push(currentYear - i);
    }
    years.push(currentYear)

    // สร้าง options ของปี
    var yearOptions = '';
    for (var i = 0; i < years.length; i++) {
        var selected = (years[i] === currentYear) ? 'selected' : '';
        yearOptions += '<option value="' + years[i] + '" ' + selected + '>' + years[i] + '</option>';
    }

    // กำหนด options ของปีให้กับ select list
    $('#year').html(yearOptions);

    // เปิดใช้งาน select2
    $('#year').select2();


    // End

    //
    // ใช้ setInterval เพื่อทำงานทุก ๆ 3 วินาที
    setInterval(function () {
        // ดึงค่า input ที่มี id เป็น "my-input"
        var inputValueca = $('#ca').val();
        var inputValueCus_name = $('#customer-name').val();
        var inputValueMonth = $('#month').val();
        var inputValueYear = $('#year').val();
        var inputValuecase = $('#cause').val();
        var inputValuecaseex = $('#case-ex').val();
        var inputValueresultP = $('#KWPPresultP-Sum').val();
        var start_date_normal = $('#start-date-normal').val();
        var end_date_normal = $('#end-date-normal').val();
        var start_date_not = $('#start-date-not').val();
        var end_date_not = $('#end-date-not').val();


        // $("#caseex-sum").text(inputValuecaseex);
        $("#start_date_normal1").text(start_date_normal);
        $("#end-date-normal1").text(end_date_normal);
        $("#start-date-not1").text(start_date_not);
        $("#end-date-not1").text(end_date_not);

    }, 3000);


    // คำนวน KWP-P
    function CalKWPP() {
        var inputValueresultP = $('#KWPPresultP-Sum').val();
        var resultworkDaynotPSum = $('#KWPPresult-workDay-notP-Sum').val();
        var KWPPBefore = parseFloat($("#KWPPBefore").val());
        var KWPPAfter = parseFloat($("#KWPPAfter").val());
        var KWPPmultiplier = parseFloat($("#KWPPmultiplier").val());
        var KWPPUnitNormol = ((KWPPAfter - KWPPBefore) * KWPPmultiplier);
        $("#KWPPUnitNormol").val((KWPPUnitNormol).toFixed(2));
        $("#KWPPAvg").val((KWPPUnitNormol / inputValueresultP).toFixed(2))
        var KWPPAvg = KWPPUnitNormol / inputValueresultP
        $("#KWPPavg-unit-tosap").val((KWPPAvg * resultworkDaynotPSum).toFixed(2))
    }
    //end
    // คำนวน KWP-OP
    function CalKWPOP() {
        var KWPOPresultP = $('#KWPOPresultP-Sum').val();
        var KWPOPresult = $('#KWPOPresult-workDay-notP-Sum').val();
        var KWPOPBefore = parseFloat($("#KWPOPBefore").val());
        var KWPOPAfter = parseFloat($("#KWPOPAfter").val());
        var KWPOPmultiplier = parseFloat($("#KWPOPmultiplier").val());
        var KWPOPUnitNormol = ((KWPOPAfter - KWPOPBefore) * KWPOPmultiplier);
        $("#KWPOPUnitNormol").val((KWPOPUnitNormol).toFixed(2));
        $("#KWPOPAvg").val((KWPOPUnitNormol / KWPOPresultP).toFixed(2))
        var KWPOPAvg = KWPOPUnitNormol / KWPOPresultP
        $("#KWPOPavg-unit-tosap").val((KWPOPAvg * KWPOPresult).toFixed(2))
    }
    //end
    // คำนวน KWP-OP
    function CalKWPH() {
        var KWPHresultP = $('#KWPHresultP-Sum').val();
        var KWPHresult = $('#KWPHresult-workDay-notP-Sum').val();
        var KWPHBefore = parseFloat($("#KWPHBefore").val());
        var KWPHAfter = parseFloat($("#KWPHAfter").val());
        var KWPHmultiplier = parseFloat($("#KWPHmultiplier").val());
        var KWPHUnitNormol = ((KWPHAfter - KWPHBefore) * KWPHmultiplier);
        $("#KWPHUnitNormol").val((KWPHUnitNormol).toFixed(2));
        $("#KWPHAvg").val((KWPHUnitNormol / KWPHresultP).toFixed(2))
        var KWPHAvg = KWPHUnitNormol / KWPHresultP
        $("#KWPHavg-unit-tosap").val((KWPHAvg * KWPHresult).toFixed(2))
        var KWPPUnitNormol = parseFloat($("#KWPPUnitNormol").val())
        var KWPOPUnitNormol = parseFloat($("#KWPOPUnitNormol").val())
        var KWPHUnitNormol = parseFloat($("#KWPHUnitNormol").val())
        var sum_normal = KWPPUnitNormol + KWPOPUnitNormol + KWPHUnitNormol
        var KWPPavg_unit_tosap = parseFloat($("#KWPPavg-unit-tosap").val())
        var KWPOPavg_unit_tosap = parseFloat($("#KWPOPavg-unit-tosap").val())
        var KWPHavg_unit_tosap = parseFloat($("#KWPHavg-unit-tosap").val())
        var sum_unit_tosap = KWPPavg_unit_tosap + KWPOPavg_unit_tosap + KWPHavg_unit_tosap
        //console.log(sum_normal)
        $("#sum-normal-final").val(numberWithCommas(sum_normal.toFixed(2)))
        $("#sum-to-sap-final").val(numberWithCommas(sum_unit_tosap.toFixed(2)))
    }
    //end
    //Function format a number
    function numberWithCommas(x) {
        x = x.toString();
        var pattern = /(-?\d+)(\d{3})/;
        while (pattern.test(x))
            x = x.replace(pattern, "$1,$2");
        return x;
    }

    // Calculator KKWPP
    function CalKKWPP() {
        var KKWPPBefore = parseFloat($("#KKWPPBefore").val());
        var KKWPPAfter = parseFloat($("#KKWPPAfter").val());
        var KKWPPmultiplier = parseFloat($("#KKWPPmultiplier").val());
        var KKWPPUnitNormol = ((KKWPPAfter - KKWPPBefore) * KKWPPmultiplier);
        $("#KKWPPUnitNormol").val((KKWPPUnitNormol).toFixed(2));
    }
    // End Calculator KKWPP
    // Calculator KKWPOP
    function CalKKWPOP() {
        var KKWPOPBefore = parseFloat($("#KKWPOPBefore").val());
        var KKWPOPAfter = parseFloat($("#KKWPOPAfter").val());
        var KKWPOPmultiplier = parseFloat($("#KKWPOPmultiplier").val());
        var KKWPOPUnitNormol = ((KKWPOPAfter - KKWPOPBefore) * KKWPOPmultiplier);
        $("#KKWPOPUnitNormol").val((KKWPOPUnitNormol).toFixed(2));
    }
    // End Calculator KKWPP
    // Calculator KKWPOP
    function CalKKWPH() {

        var KKWPHBefore = parseFloat($("#KKWPHBefore").val());
        var KKWPHAfter = parseFloat($("#KKWPHAfter").val());
        var KKWPHmultiplier = parseFloat($("#KKWPHmultiplier").val());
        var KKWPHUnitNormol = ((KKWPHAfter - KKWPHBefore) * KKWPHmultiplier);
        $("#KKWPHUnitNormol").val((KKWPHUnitNormol).toFixed(2));
    }
    // End Calculator KKWPH



    let PeaCode = localStorage.getItem("Peacode").substring(0, 4);
    $.ajax({
        url: "http://" + hostname + ":442/uploads/bacode",
        type: "GET",
        data: {
            Peacode: PeaCode,
        },
        success: function (data) {
            // console.log("Pea", data)c
            $.each(data, function (key, value) { // วน loop เพื่อสร้าง option element สำหรับแสดงข้อมูล
                $('#office').append($('<option>').text(value.office_name).attr('value', value.office_name));
            });
        }
    })
    $("#submit-btn").click(function (event) {
        event.preventDefault(); // ปิดการทำงานของปุ่ม submit หน้า HTML

        // ดึงค่าจาก input ของวันที่เริ่มต้น
        var old_start_date_normal = $('#start-date-normal').val();
        var new_start_date_normal = convertDateFormat(old_start_date_normal);
        var startDate = new_start_date_normal;

        // ดึงค่าจาก input ของวันที่สิ้นสุด
        var old_end_date_normal = $('#end-date-normal').val();
        var new_end_date_normal = convertDateFormat(old_end_date_normal);
        var endDate = new_end_date_normal;

        var old_start_date_not = $('#start-date-not').val();
        var new_start_date_not = convertDateFormat(old_start_date_not);
        var startDateNor = new_start_date_not;

        var old_end_date_not = $('#end-date-not').val();
        var new_old_end_date_not = convertDateFormat(old_end_date_not);
        var endDateNor = new_old_end_date_not;


        $.ajax({
            url: "http://" + hostname + ":442/day/calculate-days",
            type: "POST",
            data: {
                "start-date": startDate,
                "end-date": endDate,
                "start-date-nor": startDateNor,
                "end-date-nor": endDateNor,
            },
            success: function (data) {
                // แสดงผลลัพธ์จำนวนวันที่คำนวณได้
                // console.log(data);
                $("#resultP").html(" <span class='badge rounded-pill text-bg-danger'>P: " + data.workDay + " วัน</span>");
                $("#resultOP").html(" <span class='badge rounded-pill text-bg-secondary'>OP: " + data.workDay + " วัน</span>");
                $("#resultH").html(" <span class='badge rounded-pill text-bg-warning'>H: " + data.offkDay + " วัน</span>");
                $("#resultSum").html(" <span class='badge rounded-pill text-bg-light'>รวม: " + data.countDay + " วัน</span>");
                $("#result-countDay-notSum").html("<span class='badge rounded-pill text-bg-light'>รวม: " + data.countDayNor + " วัน</span>");
                $("#result-workDay-notP").html("<span class='badge rounded-pill text-bg-danger'>P: " + data.workDayNor + " วัน</span>");
                $("#result-offkDay-notOP").html("<span class='badge rounded-pill text-bg-secondary'>OP: " + data.workDayNor + " วัน</span>");
                $("#result-offkDay-notH").html("<span class='badge rounded-pill text-bg-warning'>H: " + data.offkDayNor + " วัน</span>");
                $("#resultSumAc").html("<span class='badge text-bg-dark'>รวมทั้งสิ้น: " + (data.countDay + data.countDayNor) + " วัน</span>");
                $("#resultSumAcCheckIf").val(data.countDay + data.countDayNor);
                $("#KWPPresult-workDay-notP-Sum").val(data.workDayNor)
                $("#KWPOPresult-workDay-notP-Sum").val(data.workDayNor)
                $("#KWPHresult-workDay-notP-Sum").val(data.offkDayNor)
                $("#KWPPresultP-Sum").val(data.workDay)
                $("#KWPOPresultP-Sum").val(data.workDay)
                $("#KWPHresultP-Sum").val(data.offkDay)
                $("#p_normal").val(data.workDay)
                $("#op_normal").val(data.workDay)
                $("#h_normal").val(data.offkDay)
                $("#sum_normal").val(data.countDay)
                $("#p_brok").val(data.workDayNor)
                $("#op_brok").val(data.workDayNor)
                $("#h_brok").val(data.offkDayNor)
                $("#sum_brok").val(data.countDayNor)
                $("#sum_all").val(data.countDay + data.countDayNor)


            },
        });
    });

    $("#save").click(function (event) {
        event.preventDefault();
        var getUrlParameter = function getUrlParameter(sParam) {
            var sPageURL = window.location.search.substring(1),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');

                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
                }
            }
            return false;
        };
        let iddata = getUrlParameter('id');
        console.log(iddata)
        let PeaCode = localStorage.getItem("Peacode").substring(0, 4);
        var office_name = $("#office").val();
        var ca = $("#ca").val();
        var customer_name = $("#customer-name").val();
        var rate = $("#rate").val();
        console.log(rate)
        var peano = $("#peano").val();
        var type_customer = $("#type-customer").val();
        var address = $("#address").val();
        var month = $("#month").val();
        var year = $("#year").val();
        var cause = $("#cause").val();
        var spanElement = document.getElementById("caseex-sum");
        var in_cause = spanElement.textContent

        var spanElement1 = document.getElementById("start_date_normal1");
        var normal_date_start1 = spanElement1.textContent
        var normal_date_start = convertDateFormat(normal_date_start1);

        var spanElement2 = document.getElementById("end-date-normal1");
        var normal_date_end1 = spanElement2.textContent
        var normal_date_end = convertDateFormat(normal_date_end1);

        var spanElement3 = document.getElementById("start-date-not1");
        var brok_date_start1 = spanElement3.textContent
        var brok_date_start = convertDateFormat(brok_date_start1);

        var spanElement4 = document.getElementById("end-date-not1");
        var brok_date_end1 = spanElement4.textContent
        var brok_date_end = convertDateFormat(brok_date_end1);

        var p_normal = $("#p_normal").val();
        var op_normal = $("#op_normal").val();
        var h_normal = $("#h_normal").val();
        var sum_normal = $("#sum_normal").val();
        var sum_normal_final = $("#sum-normal-final").val()
        var sum_to_sap_final = $("#sum-to-sap-final").val()
        var p_brok = $("#p_brok").val();
        var op_brok = $("#op_brok").val();
        var h_brok = $("#h_brok").val();
        var sum_brok = $("#sum_brok").val();
        var sum_all = $("#sum_all").val();
        var unit_read_after_kwh_p = $("#KWPPAfter").val();
        var unit_read_before_kwh_p = $("#KWPPBefore").val();
        var multiplier_kwh_p = $("#KWPPmultiplier").val();
        var unit_normal_kwh_p = $("#KWPPUnitNormol").val();
        var date_normal_kwh_p = $("#KWPPresultP-Sum").val();
        var avg_date_kwh_p = $("#KWPPAvg").val();
        var date_brok_kwh_p = $("#KWPPresult-workDay-notP-Sum").val();
        var unit_avg_to_sap_kwh_p = $("#KWPPavg-unit-tosap").val();
        var unit_read_after_kwh_op = $("#KWPOPAfter").val();
        var unit_read_before_kwh_op = $("#KWPOPBefore").val();
        var multiplier_kwh_op = $("#KWPOPmultiplier").val();
        var unit_normal_kwh_op = $("#KWPOPUnitNormol").val();
        var date_normal_kwh_op = $("#KWPOPresultP-Sum").val();
        var avg_date_kwh_op = $("#KWPOPAvg").val();
        var date_brok_kwh_op = $("#KWPOPresult-workDay-notP-Sum").val();
        var unit_avg_to_sap_kwh_op = $("#KWPOPavg-unit-tosap").val();
        var unit_read_after_kwh_h = $("#KWPHAfter").val();
        var unit_read_before_kwh_h = $("#KWPHBefore").val();
        var multiplier_kwh_h = $("#KWPHmultiplier").val();
        var unit_normal_kwh_h = $("#KWPHUnitNormol").val();
        var date_normal_kwh_h = $("#KWPHresultP-Sum").val();
        var avg_date_kwh_h = $("#KWPHAvg").val();
        var date_brok_kwh_h = $("#KWPHresult-workDay-notP-Sum").val();
        var unit_avg_to_sap_kwh_h = $("#KWPHavg-unit-tosap").val();
        var unit_read_after_unit_kwh_p = $("#KKWPPAfter").val();
        var unit_read_before_unit_kwh_p = $("#KKWPPBefore").val();
        var multiplier_unit_kwh_p = $("#KKWPPmultiplier").val();
        var kwh_normal_unit_kwh_p = $("#KKWPPUnitNormol").val();
        var unit_read_after_unit_kwh_op = $("#KKWPOPAfter").val();
        var unit_read_before_unit_kwh_op = $("#KKWPOPBefore").val();
        var multiplier_unit_kwh_op = $("#KKWPOPmultiplier").val();
        var kwh_normal_unit_kwh_op = $("#KKWPOPUnitNormol").val();
        var unit_read_after_unit_kwh_h = $("#KKWPHAfter").val();
        var unit_read_before_unit_kwh_h = $("#KKWPHBefore").val();
        var multiplier_unit_kwh_h = $("#KKWPHmultiplier").val();
        var kwh_normal_unit_kwh_h = $("#KKWPHUnitNormol").val();
        var comment = $("#comment").val();

        var user = localStorage.getItem("FullName");
        Swal.fire({
            title: 'ยืนกันการบันทึกข้อมูล?',
            showDenyButton: true,
            showCancelButton: true,
            confirmButtonText: 'บันทึก',
            denyButtonText: `ไม่บันทึก`,
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: "http://localhost:442/datadetail/update",
                    type: "PUT",
                    data: {
                        "id": iddata,
                        "peacode": PeaCode,
                        "office_name": office_name,
                        "ca_no": ca,
                        "name_customer": customer_name,
                        "rate": rate,
                        "pea_no": peano,
                        "type_customer": type_customer,
                        "address": address,
                        "billing_Cycle": month,
                        "year": year,
                        "cause": cause,
                        "in_cause": in_cause,
                        "normal_date_start": normal_date_start,
                        "normal_date_end": normal_date_end,
                        "brok_date_start": brok_date_start,
                        "brok_date_end": brok_date_end,
                        "p_normal": p_normal,
                        "op_normal": op_normal,
                        "h_normal": h_normal,
                        "sum_normal": sum_normal,
                        "sum_normal_final": sum_normal_final,
                        "sum_to_sap_final": sum_to_sap_final,
                        "p_brok": p_brok,
                        "op_brok": op_brok,
                        "h_brok": h_brok,
                        "sum_brok": sum_brok,
                        "sum_all": sum_all,
                        "unit_read_after_kwh_p": unit_read_after_kwh_p,
                        "unit_read_before_kwh_p": unit_read_before_kwh_p,
                        "multiplier_kwh_p": multiplier_kwh_p,
                        "unit_normal_kwh_p": unit_normal_kwh_p,
                        "date_normal_kwh_p": date_normal_kwh_p,
                        "avg_date_kwh_p": avg_date_kwh_p,
                        "date_brok_kwh_p": date_brok_kwh_p,
                        "unit_avg_to_sap_kwh_p": unit_avg_to_sap_kwh_p,
                        "unit_read_after_kwh_op": unit_read_after_kwh_op,
                        "unit_read_before_kwh_op": unit_read_before_kwh_op,
                        "multiplier_kwh_op": multiplier_kwh_op,
                        "unit_normal_kwh_op": unit_normal_kwh_op,
                        "date_normal_kwh_op": date_normal_kwh_op,
                        "avg_date_kwh_op": avg_date_kwh_op,
                        "date_brok_kwh_op": date_brok_kwh_op,
                        "unit_avg_to_sap_kwh_op": unit_avg_to_sap_kwh_op,
                        "unit_read_after_kwh_h": unit_read_after_kwh_h,
                        "unit_read_before_kwh_h": unit_read_before_kwh_h,
                        "multiplier_kwh_h": multiplier_kwh_h,
                        "unit_normal_kwh_h": unit_normal_kwh_h,
                        "date_normal_kwh_h": date_normal_kwh_h,
                        "avg_date_kwh_h": avg_date_kwh_h,
                        "date_brok_kwh_h": date_brok_kwh_h,
                        "unit_avg_to_sap_kwh_h": unit_avg_to_sap_kwh_h,
                        "unit_read_after_unit_kwh_p": unit_read_after_unit_kwh_p,
                        "unit_read_before_unit_kwh_p": unit_read_before_unit_kwh_p,
                        "multiplier_unit_kwh_p": multiplier_unit_kwh_p,
                        "kwh_normal_unit_kwh_p": kwh_normal_unit_kwh_p,
                        "unit_read_after_unit_kwh_op": unit_read_after_unit_kwh_op,
                        "unit_read_before_unit_kwh_op": unit_read_before_unit_kwh_op,
                        "multiplier_unit_kwh_op": multiplier_unit_kwh_op,
                        "kwh_normal_unit_kwh_op": kwh_normal_unit_kwh_op,
                        "unit_read_after_unit_kwh_h": unit_read_after_unit_kwh_h,
                        "unit_read_before_unit_kwh_h": unit_read_before_unit_kwh_h,
                        "multiplier_unit_kwh_h": multiplier_unit_kwh_h,
                        "kwh_normal_unit_kwh_h": kwh_normal_unit_kwh_h,
                        "user": user,
                        "comment": comment
                    },
                    success: function (data) {
                        Swal.fire({
                            icon: "success",
                            title: "บันทึกข้อมูลสำเร็จ",
                        }).then(function () {
                            window.location = "home.html";
                        });
                    },

                    error: function (data) {
                        Swal.fire({
                            icon: "warning",
                            title: "บันทึกข้อมูลไม่สำเร็จ",
                        });
                    },
                });
            } else if (result.isDenied) {
                Swal.fire('ไม่ได้บันทึกข้อมูล', '', 'info')
            }
        })

    })
    function convertDateFormat(oldDate) {
        // แยกวันที่ เดือน และปีออกจากกัน
        var parts = oldDate.split("-");
        var day = parts[0];
        var month = parts[1];
        var year = parts[2];

        // เปลี่ยนปีจาก 2566 เป็น 2023
        // year = parseInt(year) - 543;

        // สร้างวันที่ใหม่ในรูปแบบ "yyyy-mm-dd"
        var newDate = year + "-" + month + "-" + day;

        // ส่งคืนวันที่ใหม่
        return newDate;
    }

    $("#btnLogout").click(function (event) {
        event.preventDefault();
        localStorage.clear();
        Swal.fire({
            icon: "success",
            title: "ออกจากระบบเรียบร้อย",
            showCancelButton: false,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "ตกลง",
        }).then((response) => {
            if (response.isConfirmed) {
                window.location = "./sign-in.html";
            }
        });
    })
</script>